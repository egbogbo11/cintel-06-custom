[{"name": "app.py", "content": "import faicons as fa\nimport plotly.express as px\nimport os\n\nfrom shared import app_dir, tips\nfrom shiny import App, reactive, render, ui\nfrom shinywidgets import output_widget, render_plotly\n\nbill_rng = (min(tips.total_bill), max(tips.total_bill))\n\nICONS = {\n    \"user\": fa.icon_svg(\"user\", \"regular\"),\n    \"wallet\": fa.icon_svg(\"wallet\"),\n    \"currency-dollar\": fa.icon_svg(\"dollar-sign\"),\n    \"ellipsis\": fa.icon_svg(\"ellipsis\"),\n}\n\napp_ui = ui.page_sidebar(\n    ui.sidebar(\n        ui.input_slider(\n            \"total_bill\",\n            \"Bill amount\",\n            min=bill_rng[0],\n            max=bill_rng[1],\n            value=bill_rng,\n            pre=\"$\",\n        ),\n        ui.input_checkbox_group(\n            \"time\",\n            \"Food service\",\n            [\"Lunch\", \"Dinner\"],\n            selected=[\"Lunch\", \"Dinner\"],\n            inline=True,\n        ),\n        ui.input_checkbox_group(\n            \"sex\",\n            \"Gender\",\n            [\"Male\", \"Female\"],\n            selected=[\"Male\", \"Female\"],\n            inline=True,\n        ),\n        ui.input_action_button(\"reset\", \"Reset filter\"),\n        open=\"desktop\",\n    ),\n    ui.layout_columns(\n        ui.value_box(\n            \"Total tippers\", ui.output_ui(\"total_tippers\"), showcase=ICONS[\"user\"]\n        ),\n        ui.value_box(\n            \"Average tip\", ui.output_ui(\"average_tip\"), showcase=ICONS[\"wallet\"]\n        ),\n        ui.value_box(\n            \"Average bill\",\n            ui.output_ui(\"average_bill\"),\n            showcase=ICONS[\"currency-dollar\"],\n        ),\n        fill=False,\n    ),\n    ui.layout_columns(\n        ui.card(\n            ui.card_header(\"Tips data\"), ui.output_data_frame(\"table\"), full_screen=True\n        ),\n        ui.card(\n            ui.card_header(\n                \"Total bill vs tip\",\n                ui.popover(\n                    ICONS[\"ellipsis\"],\n                    ui.input_radio_buttons(\n                        \"scatter_color\",\n                        None,\n                        [\"none\", \"sex\", \"smoker\", \"day\", \"time\"],\n                        inline=True,\n                    ),\n                    title=\"Add a color variable\",\n                    placement=\"top\",\n                ),\n                class_=\"d-flex justify-content-between align-items-center\",\n            ),\n            output_widget(\"scatterplot\"),\n            full_screen=True,\n        ),\n        ui.card(\n            ui.card_header(\n                \"Average tip by category\",\n                ui.popover(\n                    ICONS[\"ellipsis\"],\n                    ui.input_radio_buttons(\n                        \"tip_perc_y\",\n                        \"Group by:\",\n                        [\"sex\", \"smoker\", \"day\", \"time\"],\n                        selected=\"day\",\n                        inline=True,\n                    ),\n                    title=\"Choose grouping\",\n                ),\n                class_=\"d-flex justify-content-between align-items-center\",\n            ),\n            output_widget(\"tip_perc\"),\n            full_screen=True,\n        ),\n        col_widths=[6, 6, 12],\n    ),\n    ui.include_css(app_dir / \"styles.css\"),\n    title=\"Restaurant tipping\",\n    fillable=True,\n)\n\n\ndef server(input, output, session):\n    @reactive.calc\n    def tips_data():\n        bill = input.total_bill()\n        idx1 = tips.total_bill.between(bill[0], bill[1])\n        idx2 = tips.time.isin(input.time())\n        idx3 = tips.sex.isin(input.sex())\n        return tips[idx1 & idx2 & idx3]\n\n    @render.ui\n    def total_tippers():\n        return tips_data().shape[0]\n\n    @render.ui\n    def average_tip():\n        d = tips_data()\n        if d.shape[0] > 0:\n            perc = d.tip / d.total_bill\n            return f\"{perc.mean():.1%}\"\n\n    @render.ui\n    def average_bill():\n        d = tips_data()\n        if d.shape[0] > 0:\n            bill = d.total_bill.mean()\n            return f\"${bill:.2f}\"\n\n    @render.data_frame\n    def table():\n        return render.DataGrid(tips_data())\n\n    @render_plotly\n    def scatterplot():\n        color = input.scatter_color()\n        return px.scatter(\n            tips_data(),\n            x=\"total_bill\",\n            y=\"tip\",\n            color=None if color == \"none\" else color,\n            title=\"Total Bill vs Tip\",\n            labels={\"total_bill\": \"Total Bill\", \"tip\": \"Tip\"},\n        )\n\n    @render_plotly\n    def tip_perc():\n        dat = tips_data()\n        yvar = input.tip_perc_y()\n        dat_grouped = dat.groupby(yvar, as_index=False)[\"tip\"].mean()\n\n        return px.bar(\n            dat_grouped,\n            x=yvar,\n            y=\"tip\",\n            title=f\"Average Tip by {yvar.capitalize()}\",\n            labels={\"tip\": \"Average Tip\"},\n            color=yvar,\n        )\n\n    @reactive.effect\n    @reactive.event(input.reset)\n    def _():\n        ui.update_slider(\"total_bill\", value=bill_rng)\n        ui.update_checkbox_group(\"time\", selected=[\"Lunch\", \"Dinner\"])\n        ui.update_checkbox_group(\"sex\", selected=[\"Male\", \"Female\"])\n\n\napp = App(app_ui, server)\n\n", "type": "text"}, {"name": "README.md", "content": "## Dashboard tips app\n\n<a href='https://connect.posit.cloud/publish?framework=shiny&sourceRepositoryURL=https%3A%2F%2Fgithub.com%2Fposit-dev%2Fpy-shiny-templates&sourceRef=main&sourceRefType=branch&primaryFile=dashboard-tips%2Fapp-express.py&pythonVersion=3.11'><img src='https://cdn.connect.posit.cloud/assets/deploy-to-connect-blue.svg' align=\"right\" /></a>\n\n\n\nThis template gives you a more \"complete\" dashboard for exploring the tips dataset. For an overview of what's here, visit [this article](https://shiny.posit.co/py/docs/user-interfaces.html).\n", "type": "text"}, {"name": "requirements.txt", "content": "faicons\nshiny\nshinywidgets\nplotly\npandas\nridgeplot\n", "type": "text"}, {"name": "shared.py", "content": "from pathlib import Path\n\nimport pandas as pd\n\napp_dir = Path(__file__).parent\ntips = pd.read_csv(app_dir / \"tips.csv\")\n", "type": "text"}, {"name": "styles.css", "content": ":root {\n  --bslib-sidebar-main-bg: #f8f8f8;\n}\n\n.popover {\n  --bs-popover-header-bg: #222;\n  --bs-popover-header-color: #fff;\n}\n\n.popover .btn-close {\n  filter: var(--bs-btn-close-white-filter);\n}", "type": "text"}, {"name": "tips.csv", "content": "total_bill,tip,sex,smoker,day,time,size\n16.99,1.01,Female,No,Sun,Dinner,2\n10.34,1.66,Male,No,Sun,Dinner,3\n21.01,3.5,Male,No,Sun,Dinner,3\n23.68,3.31,Male,No,Sun,Dinner,2\n24.59,3.61,Female,No,Sun,Dinner,4\n25.29,4.71,Male,No,Sun,Dinner,4\n8.77,2.0,Male,No,Sun,Dinner,2\n26.88,3.12,Male,No,Sun,Dinner,4\n15.04,1.96,Male,No,Sun,Dinner,2\n14.78,3.23,Male,No,Sun,Dinner,2\n10.27,1.71,Male,No,Sun,Dinner,2\n35.26,5.0,Female,No,Sun,Dinner,4\n15.42,1.57,Male,No,Sun,Dinner,2\n18.43,3.0,Male,No,Sun,Dinner,4\n14.83,3.02,Female,No,Sun,Dinner,2\n21.58,3.92,Male,No,Sun,Dinner,2\n10.33,1.67,Female,No,Sun,Dinner,3\n16.29,3.71,Male,No,Sun,Dinner,3\n16.97,3.5,Female,No,Sun,Dinner,3\n20.65,3.35,Male,No,Sat,Dinner,3\n17.92,4.08,Male,No,Sat,Dinner,2\n20.29,2.75,Female,No,Sat,Dinner,2\n15.77,2.23,Female,No,Sat,Dinner,2\n39.42,7.58,Male,No,Sat,Dinner,4\n19.82,3.18,Male,No,Sat,Dinner,2\n17.81,2.34,Male,No,Sat,Dinner,4\n13.37,2.0,Male,No,Sat,Dinner,2\n12.69,2.0,Male,No,Sat,Dinner,2\n21.7,4.3,Male,No,Sat,Dinner,2\n19.65,3.0,Female,No,Sat,Dinner,2\n9.55,1.45,Male,No,Sat,Dinner,2\n18.35,2.5,Male,No,Sat,Dinner,4\n15.06,3.0,Female,No,Sat,Dinner,2\n20.69,2.45,Female,No,Sat,Dinner,4\n17.78,3.27,Male,No,Sat,Dinner,2\n24.06,3.6,Male,No,Sat,Dinner,3\n16.31,2.0,Male,No,Sat,Dinner,3\n16.93,3.07,Female,No,Sat,Dinner,3\n18.69,2.31,Male,No,Sat,Dinner,3\n31.27,5.0,Male,No,Sat,Dinner,3\n16.04,2.24,Male,No,Sat,Dinner,3\n17.46,2.54,Male,No,Sun,Dinner,2\n13.94,3.06,Male,No,Sun,Dinner,2\n9.68,1.32,Male,No,Sun,Dinner,2\n30.4,5.6,Male,No,Sun,Dinner,4\n18.29,3.0,Male,No,Sun,Dinner,2\n22.23,5.0,Male,No,Sun,Dinner,2\n32.4,6.0,Male,No,Sun,Dinner,4\n28.55,2.05,Male,No,Sun,Dinner,3\n18.04,3.0,Male,No,Sun,Dinner,2\n12.54,2.5,Male,No,Sun,Dinner,2\n10.29,2.6,Female,No,Sun,Dinner,2\n34.81,5.2,Female,No,Sun,Dinner,4\n9.94,1.56,Male,No,Sun,Dinner,2\n25.56,4.34,Male,No,Sun,Dinner,4\n19.49,3.51,Male,No,Sun,Dinner,2\n38.01,3.0,Male,Yes,Sat,Dinner,4\n26.41,1.5,Female,No,Sat,Dinner,2\n11.24,1.76,Male,Yes,Sat,Dinner,2\n48.27,6.73,Male,No,Sat,Dinner,4\n20.29,3.21,Male,Yes,Sat,Dinner,2\n13.81,2.0,Male,Yes,Sat,Dinner,2\n11.02,1.98,Male,Yes,Sat,Dinner,2\n18.29,3.76,Male,Yes,Sat,Dinner,4\n17.59,2.64,Male,No,Sat,Dinner,3\n20.08,3.15,Male,No,Sat,Dinner,3\n16.45,2.47,Female,No,Sat,Dinner,2\n3.07,1.0,Female,Yes,Sat,Dinner,1\n20.23,2.01,Male,No,Sat,Dinner,2\n15.01,2.09,Male,Yes,Sat,Dinner,2\n12.02,1.97,Male,No,Sat,Dinner,2\n17.07,3.0,Female,No,Sat,Dinner,3\n26.86,3.14,Female,Yes,Sat,Dinner,2\n25.28,5.0,Female,Yes,Sat,Dinner,2\n14.73,2.2,Female,No,Sat,Dinner,2\n10.51,1.25,Male,No,Sat,Dinner,2\n17.92,3.08,Male,Yes,Sat,Dinner,2\n27.2,4.0,Male,No,Thur,Lunch,4\n22.76,3.0,Male,No,Thur,Lunch,2\n17.29,2.71,Male,No,Thur,Lunch,2\n19.44,3.0,Male,Yes,Thur,Lunch,2\n16.66,3.4,Male,No,Thur,Lunch,2\n10.07,1.83,Female,No,Thur,Lunch,1\n32.68,5.0,Male,Yes,Thur,Lunch,2\n15.98,2.03,Male,No,Thur,Lunch,2\n34.83,5.17,Female,No,Thur,Lunch,4\n13.03,2.0,Male,No,Thur,Lunch,2\n18.28,4.0,Male,No,Thur,Lunch,2\n24.71,5.85,Male,No,Thur,Lunch,2\n21.16,3.0,Male,No,Thur,Lunch,2\n28.97,3.0,Male,Yes,Fri,Dinner,2\n22.49,3.5,Male,No,Fri,Dinner,2\n5.75,1.0,Female,Yes,Fri,Dinner,2\n16.32,4.3,Female,Yes,Fri,Dinner,2\n22.75,3.25,Female,No,Fri,Dinner,2\n40.17,4.73,Male,Yes,Fri,Dinner,4\n27.28,4.0,Male,Yes,Fri,Dinner,2\n12.03,1.5,Male,Yes,Fri,Dinner,2\n21.01,3.0,Male,Yes,Fri,Dinner,2\n12.46,1.5,Male,No,Fri,Dinner,2\n11.35,2.5,Female,Yes,Fri,Dinner,2\n15.38,3.0,Female,Yes,Fri,Dinner,2\n44.3,2.5,Female,Yes,Sat,Dinner,3\n22.42,3.48,Female,Yes,Sat,Dinner,2\n20.92,4.08,Female,No,Sat,Dinner,2\n15.36,1.64,Male,Yes,Sat,Dinner,2\n20.49,4.06,Male,Yes,Sat,Dinner,2\n25.21,4.29,Male,Yes,Sat,Dinner,2\n18.24,3.76,Male,No,Sat,Dinner,2\n14.31,4.0,Female,Yes,Sat,Dinner,2\n14.0,3.0,Male,No,Sat,Dinner,2\n7.25,1.0,Female,No,Sat,Dinner,1\n38.07,4.0,Male,No,Sun,Dinner,3\n23.95,2.55,Male,No,Sun,Dinner,2\n25.71,4.0,Female,No,Sun,Dinner,3\n17.31,3.5,Female,No,Sun,Dinner,2\n29.93,5.07,Male,No,Sun,Dinner,4\n10.65,1.5,Female,No,Thur,Lunch,2\n12.43,1.8,Female,No,Thur,Lunch,2\n24.08,2.92,Female,No,Thur,Lunch,4\n11.69,2.31,Male,No,Thur,Lunch,2\n13.42,1.68,Female,No,Thur,Lunch,2\n14.26,2.5,Male,No,Thur,Lunch,2\n15.95,2.0,Male,No,Thur,Lunch,2\n12.48,2.52,Female,No,Thur,Lunch,2\n29.8,4.2,Female,No,Thur,Lunch,6\n8.52,1.48,Male,No,Thur,Lunch,2\n14.52,2.0,Female,No,Thur,Lunch,2\n11.38,2.0,Female,No,Thur,Lunch,2\n22.82,2.18,Male,No,Thur,Lunch,3\n19.08,1.5,Male,No,Thur,Lunch,2\n20.27,2.83,Female,No,Thur,Lunch,2\n11.17,1.5,Female,No,Thur,Lunch,2\n12.26,2.0,Female,No,Thur,Lunch,2\n18.26,3.25,Female,No,Thur,Lunch,2\n8.51,1.25,Female,No,Thur,Lunch,2\n10.33,2.0,Female,No,Thur,Lunch,2\n14.15,2.0,Female,No,Thur,Lunch,2\n16.0,2.0,Male,Yes,Thur,Lunch,2\n13.16,2.75,Female,No,Thur,Lunch,2\n17.47,3.5,Female,No,Thur,Lunch,2\n34.3,6.7,Male,No,Thur,Lunch,6\n41.19,5.0,Male,No,Thur,Lunch,5\n27.05,5.0,Female,No,Thur,Lunch,6\n16.43,2.3,Female,No,Thur,Lunch,2\n8.35,1.5,Female,No,Thur,Lunch,2\n18.64,1.36,Female,No,Thur,Lunch,3\n11.87,1.63,Female,No,Thur,Lunch,2\n9.78,1.73,Male,No,Thur,Lunch,2\n7.51,2.0,Male,No,Thur,Lunch,2\n14.07,2.5,Male,No,Sun,Dinner,2\n13.13,2.0,Male,No,Sun,Dinner,2\n17.26,2.74,Male,No,Sun,Dinner,3\n24.55,2.0,Male,No,Sun,Dinner,4\n19.77,2.0,Male,No,Sun,Dinner,4\n29.85,5.14,Female,No,Sun,Dinner,5\n48.17,5.0,Male,No,Sun,Dinner,6\n25.0,3.75,Female,No,Sun,Dinner,4\n13.39,2.61,Female,No,Sun,Dinner,2\n16.49,2.0,Male,No,Sun,Dinner,4\n21.5,3.5,Male,No,Sun,Dinner,4\n12.66,2.5,Male,No,Sun,Dinner,2\n16.21,2.0,Female,No,Sun,Dinner,3\n13.81,2.0,Male,No,Sun,Dinner,2\n17.51,3.0,Female,Yes,Sun,Dinner,2\n24.52,3.48,Male,No,Sun,Dinner,3\n20.76,2.24,Male,No,Sun,Dinner,2\n31.71,4.5,Male,No,Sun,Dinner,4\n10.59,1.61,Female,Yes,Sat,Dinner,2\n10.63,2.0,Female,Yes,Sat,Dinner,2\n50.81,10.0,Male,Yes,Sat,Dinner,3\n15.81,3.16,Male,Yes,Sat,Dinner,2\n7.25,5.15,Male,Yes,Sun,Dinner,2\n31.85,3.18,Male,Yes,Sun,Dinner,2\n16.82,4.0,Male,Yes,Sun,Dinner,2\n32.9,3.11,Male,Yes,Sun,Dinner,2\n17.89,2.0,Male,Yes,Sun,Dinner,2\n14.48,2.0,Male,Yes,Sun,Dinner,2\n9.6,4.0,Female,Yes,Sun,Dinner,2\n34.63,3.55,Male,Yes,Sun,Dinner,2\n34.65,3.68,Male,Yes,Sun,Dinner,4\n23.33,5.65,Male,Yes,Sun,Dinner,2\n45.35,3.5,Male,Yes,Sun,Dinner,3\n23.17,6.5,Male,Yes,Sun,Dinner,4\n40.55,3.0,Male,Yes,Sun,Dinner,2\n20.69,5.0,Male,No,Sun,Dinner,5\n20.9,3.5,Female,Yes,Sun,Dinner,3\n30.46,2.0,Male,Yes,Sun,Dinner,5\n18.15,3.5,Female,Yes,Sun,Dinner,3\n23.1,4.0,Male,Yes,Sun,Dinner,3\n15.69,1.5,Male,Yes,Sun,Dinner,2\n19.81,4.19,Female,Yes,Thur,Lunch,2\n28.44,2.56,Male,Yes,Thur,Lunch,2\n15.48,2.02,Male,Yes,Thur,Lunch,2\n16.58,4.0,Male,Yes,Thur,Lunch,2\n7.56,1.44,Male,No,Thur,Lunch,2\n10.34,2.0,Male,Yes,Thur,Lunch,2\n43.11,5.0,Female,Yes,Thur,Lunch,4\n13.0,2.0,Female,Yes,Thur,Lunch,2\n13.51,2.0,Male,Yes,Thur,Lunch,2\n18.71,4.0,Male,Yes,Thur,Lunch,3\n12.74,2.01,Female,Yes,Thur,Lunch,2\n13.0,2.0,Female,Yes,Thur,Lunch,2\n16.4,2.5,Female,Yes,Thur,Lunch,2\n20.53,4.0,Male,Yes,Thur,Lunch,4\n16.47,3.23,Female,Yes,Thur,Lunch,3\n26.59,3.41,Male,Yes,Sat,Dinner,3\n38.73,3.0,Male,Yes,Sat,Dinner,4\n24.27,2.03,Male,Yes,Sat,Dinner,2\n12.76,2.23,Female,Yes,Sat,Dinner,2\n30.06,2.0,Male,Yes,Sat,Dinner,3\n25.89,5.16,Male,Yes,Sat,Dinner,4\n48.33,9.0,Male,No,Sat,Dinner,4\n13.27,2.5,Female,Yes,Sat,Dinner,2\n28.17,6.5,Female,Yes,Sat,Dinner,3\n12.9,1.1,Female,Yes,Sat,Dinner,2\n28.15,3.0,Male,Yes,Sat,Dinner,5\n11.59,1.5,Male,Yes,Sat,Dinner,2\n7.74,1.44,Male,Yes,Sat,Dinner,2\n30.14,3.09,Female,Yes,Sat,Dinner,4\n12.16,2.2,Male,Yes,Fri,Lunch,2\n13.42,3.48,Female,Yes,Fri,Lunch,2\n8.58,1.92,Male,Yes,Fri,Lunch,1\n15.98,3.0,Female,No,Fri,Lunch,3\n13.42,1.58,Male,Yes,Fri,Lunch,2\n16.27,2.5,Female,Yes,Fri,Lunch,2\n10.09,2.0,Female,Yes,Fri,Lunch,2\n20.45,3.0,Male,No,Sat,Dinner,4\n13.28,2.72,Male,No,Sat,Dinner,2\n22.12,2.88,Female,Yes,Sat,Dinner,2\n24.01,2.0,Male,Yes,Sat,Dinner,4\n15.69,3.0,Male,Yes,Sat,Dinner,3\n11.61,3.39,Male,No,Sat,Dinner,2\n10.77,1.47,Male,No,Sat,Dinner,2\n15.53,3.0,Male,Yes,Sat,Dinner,2\n10.07,1.25,Male,No,Sat,Dinner,2\n12.6,1.0,Male,Yes,Sat,Dinner,2\n32.83,1.17,Male,Yes,Sat,Dinner,2\n35.83,4.67,Female,No,Sat,Dinner,3\n29.03,5.92,Male,No,Sat,Dinner,3\n27.18,2.0,Female,Yes,Sat,Dinner,2\n22.67,2.0,Male,Yes,Sat,Dinner,2\n17.82,1.75,Male,No,Sat,Dinner,2\n18.78,3.0,Female,No,Thur,Dinner,2\n", "type": "text"}]